# 阶段5：用户交互界面

## 目标
实现Athens系统的用户交互界面，支持CLI界面、参与模式、用户指令处理和实时显示优化。

## 具体任务

### 5.1 CLI基础界面
实现 `src/ui/cli_interface.py`：
- 使用Rich库美化命令行界面
- 支持彩色输出和格式化显示
- 实现菜单系统和交互流程
- 提供清晰的用户指引

界面功能：
```python
class CLIInterface:
    def show_welcome(self)
    def show_menu(self)
    def get_user_input(self, prompt: str)
    def display_message(self, message: Message)
    def show_debate_progress(self, status: DebateStatus)
    def handle_user_command(self, command: str)
```

界面元素：
- 欢迎界面和说明
- 主菜单选项
- 辩论进度显示
- 消息格式化展示
- 用户输入提示

### 5.2 参与模式实现
实现场景2（用户参与模式）：
- 用户可在辩论中途介入
- 支持向特定智能体发送消息
- 提供引用回复功能
- 实现@机制和指令系统

参与模式特性：
- 实时辩论观察
- 随时插入评论
- 引导讨论方向
- 向智能体提问

用户指令：
- `/pause` - 暂停辩论
- `/resume` - 继续辩论
- `/end` - 结束辩论
- `@logician 你应该考虑...` - 向逻辑者发消息
- `@skeptic 关于这个观点...` - 向怀疑者发消息
- `/status` - 查看辩论状态
- `/help` - 显示帮助信息

### 5.3 用户指令处理
实现 `src/ui/command_processor.py`：
- 解析用户输入指令
- 处理@引用和回复
- 执行系统命令
- 验证输入有效性

指令处理：
```python
class CommandProcessor:
    def parse_command(self, input_text: str)
    def execute_system_command(self, command: str)
    def process_mention(self, target: str, message: str)
    def validate_input(self, input_text: str)
```

### 5.4 实时显示优化
实现动态显示和交互优化：
- 实时刷新辩论进展
- 消息滚动和历史查看
- 智能分页显示
- 响应式界面布局

显示优化：
- 消息高亮和分类显示
- 智能体头像和标识
- 时间戳和状态指示
- 滚动历史和搜索

## 文件清单
需要创建的文件：
- [ ] src/ui/cli_interface.py
- [ ] src/ui/command_processor.py
- [ ] src/ui/display_utils.py
- [ ] tests/test_ui.py

需要修改的文件：
- [ ] src/ui/__init__.py (导出UI类)
- [ ] src/main.py (集成UI界面)

## 测试方法
1. CLI界面显示效果测试
2. 用户指令解析验证
3. 参与模式交互测试
4. 显示性能和响应测试
5. 异常输入处理测试

## 依赖关系
- **前置条件**：阶段4的辩论管理器
- **后续阶段**：阶段6报告生成将从UI触发
- **关键输出**：完整的用户交互体验

## 验收标准
- ✅ CLI界面美观易用
- ✅ 参与模式功能完整
- ✅ 用户指令正确处理
- ✅ 实时显示流畅自然
- ✅ 所有交互测试通过

## 设计要点

### 界面布局示例
```
╔══════════════════════════════════════════════════════════╗
║                    Athens 思辨广场 MVP                    ║
╠══════════════════════════════════════════════════════════╣
║ 话题: Elixir具有很强的容错性                               ║
║ 状态: 进行中 | 轮次: 3/10 | 参与者: 逻辑者, 怀疑者         ║
╠══════════════════════════════════════════════════════════╣
║ 🤔 逻辑者 [14:32]                                         ║
║ 基于Actor模型，Elixir确实具有出色的容错性...              ║
║                                                          ║
║ 🤨 怀疑者 [14:33]                                         ║
║ 但这种说法过于绝对，我们需要考虑...                      ║
║                                                          ║
║ 👤 用户 [14:34]                                           ║
║ @skeptic 你能举个具体的反例吗？                           ║
╠══════════════════════════════════════════════════════════╣
║ 输入: /pause | /end | @agent 消息 | 直接消息              ║
╚══════════════════════════════════════════════════════════╝
```

### 交互流程
1. **启动界面**：显示欢迎信息和选项
2. **模式选择**：观察模式 vs 参与模式
3. **话题输入**：用户提供辩论话题
4. **辩论进行**：实时显示对话过程
5. **用户参与**：响应用户指令和输入
6. **结果展示**：显示辩论总结

### 用户体验优化
- 智能补全和提示
- 快捷键支持
- 历史记录保存
- 个性化设置